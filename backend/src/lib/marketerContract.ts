/**
 * Шаблон договора возмездного оказания услуг для маркетологов.
 * Подстановки: CONTRACT_NUMBER, CITY, DATE_DAY, DATE_MONTH, DATE_YEAR, SITE_URL,
 * PERCENT, EXECUTOR_*, ORDERER_*, ACCEPT_DATE_TIME, SESSION_ID.
 */

const ORDERER_FIO = 'Сапронов Павел Анатольевич'
const ORDERER_INN = '463234953250'
const ORDERER_PASSPORT = '3808 551472'
const ORDERER_PHONE_EMAIL = 'ArendaRate@yandex.ru'
const SITE_URL_DEFAULT = 'https://arendarate.ru'

const CONTRACT_TEMPLATE = `ДОГОВОР ВОЗМЕЗДНОГО ОКАЗАНИЯ УСЛУГ № CONTRACT_NUMBER

г. CITY                                                                                   «DATE_DAY» DATE_MONTH DATE_YEAR г.

Индивидуальный предприниматель (Самозанятый) ORDERER_FIO, действующий в статусе плательщика налога на профессиональный доход (НПД), именуемый в дальнейшем «Заказчик», с одной стороны, и

Гражданин(ка) РФ EXECUTOR_FIO, (Паспорт: EXECUTOR_PASSPORT), именуемый в дальнейшем «Исполнитель», с другой стороны,

совместно именуемые «Стороны», заключили настоящий Договор о нижеследующем:

---

1. ТЕРМИНЫ И ОПРЕДЕЛЕНИЯ

1.1. Сайт Заказчика – интернет-ресурс, расположенный по адресу: SITE_URL.
1.2. Промокод – уникальный буквенно-цифровой код, генерируемый функционалом Сайта. Единственное назначение Промокода – техническая фиксация факта перехода Клиента и идентификация Исполнителя в статистике Сайта.
1.3. Клиент – любое третье лицо, осуществившее заказ товаров/услуг Заказчика с применением Промокода Исполнителя.
1.4. Личный кабинет Исполнителя – персонифицированный раздел Сайта, отображающий сумму «Заработано» (накопительный итог).
1.5. Отчетный период – календарный месяц.
1.6. Запрос на выплату – электронное требование, сформированное Исполнителем в Личном кабинете и направленное Заказчику через функционал Сайта.

---

2. ПРЕДМЕТ ДОГОВОРА

2.1. Заказчик поручает, а Исполнитель принимает на себя обязательства по оказанию маркетинговых услуг по привлечению целевого трафика на Сайт Заказчика.
2.2. Услугой считается: совершение Исполнителем действий по размещению рекламных материалов, ссылок и/или Промокода в открытых источниках (социальные сети, мессенджеры, блоги) с целью побудить Клиента совершить целевое действие (оплату) на Сайте Заказчика.
2.3. Исполнитель НЕ является агентом, НЕ участвует в расчетах, НЕ принимает оплату от Клиентов, НЕ действует от имени Заказчика в отношениях с Клиентами. Промокод является исключительно техническим идентификатором и не наделяет Исполнителя полномочиями представителя Заказчика.
2.4. Результатом услуг является факт оплаты товаров/услуг Клиентом на Сайте Заказчика с применением Промокода Исполнителя.

---

3. ПОРЯДОК ОКАЗАНИЯ УСЛУГ И ФИКСАЦИИ РЕЗУЛЬТАТА

3.1. Исполнитель самостоятельно формирует рекламные объявления и креативы.
3.2. Обязательное условие: Исполнитель обязан указывать в рекламных материалах Промокод, сгенерированный системой Сайта Заказчика.
3.3. Факт оказания услуги подтверждается:
- наличием записи в базе данных Сайта о списании денежных средств Клиента;
- наличием Промокода Исполнителя в чеке/заказе Клиента;
- ежемесячным Отчетом, доступным Исполнителю в Личном кабинете в режиме реального времени.
3.4. Акт сдачи-приемки: ввиду технической фиксации результатов в Личном кабинете, данные Отчета за Отчетный период признаются Сторонами акцептованным Актом. Подписание двустороннего бумажного акта не требуется. Исполнитель подтверждает, что данные Личного кабинета являются достоверными и достаточными.

---

4. ПРАВА И ОБЯЗАННОСТИ СТОРОН

4.1. Исполнитель обязуется:
4.1.1. Соблюдать требования законодательства РФ о рекламе.
4.1.2. Не использовать спам, фишинг и иные запрещенные методы продвижения.
4.1.3. Согласовывать с Заказчиком рекламные макеты, если они содержат прямые контактные данные или товарные знаки Заказчика (срок согласования – не более 24 рабочих часов).
4.1.4. Самостоятельно отслеживать сумму заработка в Личном кабинете.

4.2. Заказчик обязуется:
4.2.1. Обеспечить бесперебойную работу функционала Сайта в части учета Промокодов.
4.2.2. Выплачивать вознаграждение при поступлении Запроса на выплату от Исполнителя.
4.2.3. Обеспечить конфиденциальность данных (ФЗ «О персональных данных»).

4.3. Заказчик вправе:
4.3.1. В любой момент заблокировать Промокод при нарушении Исполнителем условий п.4.1.2. (спам/фишинг) без выплаты вознаграждения за период, в котором зафиксировано нарушение.

---

5. ЦЕНА УСЛУГИ И ПОРЯДОК РАСЧЕТОВ (KPI)

5.1. Стоимость услуг Исполнителя составляет PERCENT% (____ процентов) от суммы каждой успешной оплаты Клиента (комиссия платежных систем/эквайринг не вычитается, НДС не облагается в связи с применением Заказчиком НПД).
5.2. Момент возникновения обязательства по оплате услуги:
- Технически: момент успешного списания денежных средств Клиента с банковской карты/счета и присвоения заказу статуса «Оплачен»;
- Юридически: момент отображения денежной суммы в графе «Заработано» в Личном кабинете Исполнителя.
5.3. Порядок выплаты (Режим реального времени):
5.3.1. Исполнитель в любое время (в том числе ежедневно) через интерфейс Сайта формирует «Запрос на выплату» на сумму, не превышающую текущий баланс в Личном кабинете.
5.3.2. Заказчик получает уведомление о Запросе на выплату.
5.3.3. Заказчик обязуется перевести денежные средства в течение 24 (двадцати четырех) часов с момента получения Запроса, если иное не оговорено в особых условиях.
5.3.4. После получения денежных средств Исполнитель обязан незамедлительно (в момент получения) сформировать чек самозанятого в приложении «Мой налог» и направить скан/скриншот чека Заказчику в мессенджер/Telegram. Без предоставления чека обязательство Заказчика по оплате считается исполненным, но риск налоговых претензий лежит на Исполнителе.
5.4. Ограничение (Анти-риск): Стороны пришли к соглашению, что привязка вознаграждения к % от сделки не означает бессрочного характера выплат. В случае, если Исполнитель более 60 (шестидесяти) календарных дней не совершал активных действий по привлечению (отсутствуют клики, показы, новые Промокоды), Стороны признают услуги за последующие периоды по данному Промокоду автоматически оказанными в момент первичной настройки. Вознаграждение за такие периоды не начисляется и не выплачивается, чтобы избежать эффекта «пассивного дохода».

---

6. ОТВЕТСТВЕННОСТЬ СТОРОН

6.1. За нарушение срока оплаты по п.5.3.3. Заказчик выплачивает пеню в размере 0,1% от суммы задолженности за каждый день просрочки, но не более 10% от суммы.
6.2. Исполнитель несет ответственность за нарушение авторских прав при использовании контента (изображений, видео, текстов).

---

7. СРОК ДЕЙСТВИЯ И АКЦЕПТ

7.1. Договор вступает в силу с момента акцепта публичной оферты (нажатия кнопки «Принимаю условия» / «Начать работу» в Личном кабинете на Сайте Заказчика).
7.2. Договор заключается на срок 1 (один) год с автоматической пролонгацией, если ни одна из сторон не заявила о расторжении за 14 дней до окончания срока.

---

8. ОСОБЫЕ УСЛОВИЯ (ЮРИДИЧЕСКАЯ БЕЗОПАСНОСТЬ)

8.1. Отсутствие трудовых отношений. Ничто в настоящем Договоре не может рассматриваться как возникновение трудовых отношений между Заказчиком и Исполнителем.
8.2. Нарушение запрета на посредничество. Исполнитель подтверждает, что ему известно о запрете для плательщиков НПД заниматься деятельностью по агентским договорам (ч. 2 ст. 4 Закона № 422-ФЗ). Настоящий Договор не является агентским. Исполнитель самостоятельно выбирает способы достижения результата и не взаимодействует с Клиентами от имени Заказчика.

---

9. РЕКВИЗИТЫ И ПОДПИСИ

Заказчик (Самозанятый):
ФИО: ORDERER_FIO
ИНН: ORDERER_INN
Паспорт: ORDERER_PASSPORT
Телефон/E-mail: ORDERER_PHONE_EMAIL

Исполнитель (Самозанятый/Физлицо):
ФИО: EXECUTOR_FIO
ИНН (при наличии): EXECUTOR_INN
Паспорт: EXECUTOR_PASSPORT
Телефон/E-mail: EXECUTOR_PHONE / EXECUTOR_EMAIL

Акцептовано (подписано) посредством функционала Сайта Заказчика ACCEPT_DATE_TIME
SESSION_ID (цифровой идентификатор сессии)
`;

export interface MarketerProfileForContract {
  id: string;
  email: string;
  percentage: number;
  fullName: string | null;
  inn: string | null;
  passport: string | null;
  phone: string | null;
  contractAcceptedAt: Date | null;
}

export interface ContractFillOptions {
  siteUrl?: string;
  siteName?: string;
  contractNumber?: string;
  city?: string;
}

const MONTHES = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];

export function fillMarketerContract(
  profile: MarketerProfileForContract,
  options: ContractFillOptions = {}
): string {
  const siteUrl = options.siteUrl || process.env.FRONTEND_URL || SITE_URL_DEFAULT;
  const city = options.city || 'Москва';
  const contractNumber = options.contractNumber || `AR-${profile.id.slice(0, 8).toUpperCase()}`;
  const acceptedAt = profile.contractAcceptedAt ? new Date(profile.contractAcceptedAt) : new Date();
  const day = acceptedAt.getDate();
  const month = MONTHES[acceptedAt.getMonth()];
  const year = acceptedAt.getFullYear();
  const acceptDateTime = profile.contractAcceptedAt
    ? new Date(profile.contractAcceptedAt).toLocaleString('ru-RU', { dateStyle: 'medium', timeStyle: 'medium' })
    : '—';
  const sessionId = profile.contractAcceptedAt
    ? `${profile.id}-${new Date(profile.contractAcceptedAt).getTime()}`
    : profile.id;

  const replacements: Record<string, string> = {
    CONTRACT_NUMBER: contractNumber,
    CITY: city,
    DATE_DAY: String(day),
    DATE_MONTH: month,
    DATE_YEAR: String(year),
    SITE_URL: siteUrl,
    PERCENT: String(profile.percentage),
    ORDERER_FIO,
    ORDERER_INN,
    ORDERER_PASSPORT,
    ORDERER_PHONE_EMAIL,
    EXECUTOR_FIO: profile.fullName || '[не указано]',
    EXECUTOR_PASSPORT: profile.passport || '[не указано]',
    EXECUTOR_INN: profile.inn || '[не указано]',
    EXECUTOR_PHONE: profile.phone || '[не указано]',
    EXECUTOR_EMAIL: profile.email || '[не указано]',
    ACCEPT_DATE_TIME: acceptDateTime,
    SESSION_ID: sessionId,
  };

  let out = CONTRACT_TEMPLATE;
  for (const [key, value] of Object.entries(replacements)) {
    out = out.split(key).join(value);
  }
  return out;
}
